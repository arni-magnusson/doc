# R Package Development at ICES

## Introduction

### This document

#### A guided tour

This document provides a basic overview of how we might organize R package
development at ICES. The intended audience is R programmers within the ICES
community, who might contribute functions to R packages maintained by ICES.

The overview is organized as a quick walk through the inner structure of the
**icesAdvice** package version 1.1-0 (CRAN version from 18 May 2016). Using this
minimal example, the essential topics are visited by going through one file at a
time.

#### References

The overview concludes with a list of free books and manuals related to R
package development, where topics are covered in greater depth.

### Where ICES packages live

#### GitHub

GitHub is a code repository, where ongoing development takes place. Several
people can have write-access and work together on development and maintenance. R
packages on GitHub may or may not work at a given moment, documentation might be
missing, etc.

#### CRAN

CRAN is the official R archive for distributing packages to the global user
community. Packages on CRAN are guaranteed to pass a series of integrity tests
of code and documentation.

### The icesAdvice package

#### Repository and distribution

The code repository is at<br>
https://github.com/ices-tools-prod/icesAdvice

Version 1.1-0 of the package was submitted to CRAN on 18 May 2016, where it can
be found at<br>
https://cran.r-project.org/package=icesAdvice

#### Roxygen

The icesAdvice package is developed using Roxygen. This means that the
`NAMESPACE` and `*.Rd` documentation files are produced automatically from the
main `*.R` source files.

## Root files

### .Rbuildignore

List of files that are not a part of the R package itself.

### .travis.yml

Configuration file that enables automatic Travis build tests.

### DESCRIPTION

The backbone of an R package: version number, authors, required packages,
license, etc.

### NAMESPACE

List of functions that the package provides for users, as well as functions
required from other packages. (This file is automatically generated by Roxygen.)

### NEWS

Version history and user-visible changes in each release.

### README.md

GitHub front page, including Travis and CRAN badges.

## R files

### Bpa.R

Source code and documentation for the `Bpa` function. Note how the Roxygen
comments end up in `man/Bpa.Rd` and `NAMESPACE`.

### Fpa.R, sigmaCI.R, sigmaPA.R

Similar to the `Bpa.R` file.

### icesAdvice-package.R

Package documentation: annotated list of functions, where related functions are
grouped together, URL references, required functions from other packages. Note
how the Roxygen comments end up in `icesAdvice-package.Rd` and `NAMESPACE`.

## Development guidelines

The first two points are important: to build and check, and to document
user-visible changes.

### Build and check

When developers make changes to the package, they should check if the package
builds without errors or warnings, before committing changes to the central
repository. This can be done in the command line by running:

```
R CMD build icesAdvice
R CMD check --as-cran icesAdvice_1.1-0.tar.gz
```

The same test is used by Travis and CRAN to test whether the package is
broken.

### Document user-visible changes

Whenever user-visible functionality is added/modified, this should be documented
in the `NEWS` file. Keeping track of new functions/arguments/behavior is very
useful for package developers and users.

### Version number

The tradition for R packages is to use version numbers that consist of three
counters, for example 1.2-3. It's practical to have the three counters indicate
the nature of changes between releases:

1. The first counter (*major*) is incremented when existing user scripts will
   not give the same output as before. Breaking backward compatibility with a
   major release can be inconvenient for users, but is sometimes done to adopt
   an improved overall design.

2. The second counter (*minor*) means new functions, new arguments, or the like.
   A minor release suggests that it's worthwhile for the user to read about the
   new functionality.

3. The third counter (*patch*) is used for other improvements. A patch release
   may introduce bug fixes, improved documentation, etc.

The package version number is mainly referring to formal releases, and does not
have to be changed during incremental development. At the time of release, the
list of changes in the `NEWS` file are reviewed to determine the appropriate
version number.

### Dependencies

The number of required packages should be kept at an absolute minimum.
This will make the package more reliable and easier to maintain.
Furthermore, many users will appreciate if the package can be used
without installing additional packages.

A key difference between personal R scripts and a general R package is that
scripts tend to require many packages, but R packages should ideally require
only the core R packages, like **base**, **graphics**, and **stats**.

It is fine for developers to use dependency-intensive tools like **devtools**,
**knitr**, **rmarkdown**, and **roxygen2** for developing packages. The end user
does not require these tools to install and use the package.

R programmers work in a variety of development environments: Linux/Windows,
Emacs/RStudio, etc. When collaborating with others in package development and
maintenance, files or pathways that are specific to one development environment
should be avoided.

### Style

There is no need to enforce some ICES style of R code appearance, when it comes
to indentation, spaces between characters, and maximum length of lines. It is
nevertheless helpful to have a consistent style within a given file. The easiest
way to achieve this is polite coding:

* When modifying an existing file, follow (exactly) the style found within that
  file.

* When creating a new file, use a consistent style within that file.

This means that within a given project (e.g., a package) several styles may
coexist, but each file uses a consistent style. Among the common characteristics
of good programming styles are that all text files end with a newline character,
and trailing spaces should be avoided.

## References

### Writing R packages

* R Core Team. 2016. ***Writing R extensions***. Vienna: R Foundation for
  Statistical Computing. Available at:<br>
  https://cran.r-project.org/doc/manuals/r-release/R-exts.html and<br>
  https://cran.r-project.org/doc/manuals/r-release/R-exts.pdf

* Wickham, H. 2015. ***R packages***. Sebastopol: O'Reilly. Available at:<br>
  http://r-pkgs.had.co.nz

### Development tools

* Chacon, S. and B. Straub. 2014. ***Pro Git***, 2nd ed. New York: Apress.
  Available at:<br>
  https://git-scm.com/book/en/v2

* ESS Developers. 2016. ***Emacs Speaks Statistics***. User manual.
  Available at:<br>
  http://ess.r-project.org/Manual/ess.html and<br>
  http://ess.r-project.org/ess.pdf

* RStudio. 2016. ***RStudio cheat sheets: RStudio IDE, devtools, R Markdown***.
  User manuals. Available at:<br>
  https://www.rstudio.com/resources/cheatsheets/

* Wickham, H. 2015. ***Introduction to roxygen2***. R package vignette.
  Available at:<br>
  https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html
